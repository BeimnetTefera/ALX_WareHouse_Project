SELECT
    TRIM(first_name) AS first_name,
    TRIM(last_name) AS last_name,
    TRIM(email) AS email,
    TRIM(course_name) AS course_name,
    TRIM(assignment_name) AS assignment_name,
    TRIM(is_assignment_accessed) AS is_assignment_accessed,
    TRIM(is_assignment_submitted) AS is_assignment_submitted,
    TRIM(is_assignment_passed) AS is_assignment_passed,
    TRIM(
        CASE 
            WHEN contact_phone LIKE '+251%' THEN contact_phone
            WHEN contact_phone LIKE '251%'  THEN CONCAT('+', contact_phone)
            WHEN contact_phone LIKE '0%'    THEN CONCAT('+251', SUBSTRING(contact_phone, 2, LEN(contact_phone)))
            ELSE CONCAT('+251', contact_phone)
        END
    ) AS contact_phone,
    CAST(TRIM(age) AS INT) AS age,
    TRIM(age_range) AS age_range,
    TRIM(country_of_residence) AS country_of_residence,
    TRIM(category_country_of_residences) AS category_country_of_residences,
    TRIM(city_of_residence) AS city_of_residence,
    CAST(TRIM(day_of_activation) AS INT) AS day_of_activation,
    TRIM(cohort_name) AS cohort_name,
    TRIM(class_name) AS class_name,
    TRIM(location_program_cohort) AS location_program_cohort,
    TRIM(assignment_type) AS assignment_type,
    CAST(TRIM(assignment_score) AS FLOAT) AS assignment_score,
    TRIM(learner_enrolled_into_lms) AS learner_enrolled_into_lms,
    TRIM(has_logged_into_lms) AS has_logged_into_lms,
    TRIM(has_logged_into_eHub) AS has_logged_into_eHub,
    TRIM(has_shown_up_in_circle) AS has_shown_up_in_circle,
    TRIM(has_shown_up_in_circle_during_the_last_two_days) AS has_shown_up_in_circle_during_the_last_two_days,
    TRIM(is_engaged_in_circle) AS is_engaged_in_circle,
    TRIM(is_engaged_in_circle_during_the_last_two_days) AS is_engaged_in_circle_during_the_last_two_days,
    TRIM(enrollment_program_activated) AS enrollment_program_activated,
    TRIM(enrollment_in_previous_withdrawn_class) AS enrollment_in_previous_withdrawn_class,
    TRIM(enrollment_course_activated) AS enrollment_course_activated,
    TRIM(is_program_withdrawn) AS is_program_withdrawn,
    TRIM(program_withdrawal_reason) AS program_withdrawal_reason,
    CAST(TRIM(program_withdrawn_date) AS DATETIME) AS program_withdrawn_date,
    TRIM(is_course_deferred) AS is_course_deferred,
    CAST(TRIM(course_deferred_date) AS DATETIME) AS course_deferred_date,
    TRIM(on_track_for_on_time_graduation) AS on_track_for_on_time_graduation,
    TRIM(on_track_for_delayed_graduation) AS on_track_for_delayed_graduation,
    TRIM(is_assignment_resubmitted) AS is_assignment_resubmitted,
    TRIM(iassignment_resubmitted_and_not_corrected_yet) AS iassignment_resubmitted_and_not_corrected_yet,
    TRIM(is_assignment_graded) AS is_assignment_graded,
    TRIM(is_assignment_corrected_by_an_external_grader) AS is_assignment_corrected_by_an_external_grader,
    TRIM(corrected_external_grader_name) AS corrected_external_grader_name,
    TRIM(corrected_external_grader_email) AS corrected_external_grader_email,
    TRIM(is_on_track) AS is_on_track,
    CAST(TRIM(no_of_assignment_submissions) AS INT) AS no_of_assignment_submissions,
    TRIM(submission_link) AS submission_link,
    CAST(TRIM(no_of_assignmnets) AS INT) AS no_of_assignmnets,
    CAST(TRIM(no_of_submissions) AS INT) AS no_of_submissions,
    CAST(TRIM(no_of_assignments_passed) AS INT) AS no_of_assignments_passed,
    CAST(TRIM(no_of_milestone) AS INT) AS no_of_milestone,
    CAST(TRIM(no_of_milestone_submissions) AS INT) AS no_of_milestone_submissions,
    CAST(TRIM(no_of_milestones_passed) AS INT) AS no_of_milestones_passed,
    CAST(TRIM(no_of_quizzes) AS INT) AS no_of_quizzes,
    CAST(TRIM(no_of_quizzes_submitted) AS INT) AS no_of_quizzes_submitted,
    CAST(TRIM(no_of_quizzes_passed) AS INT) AS no_of_quizzes_passed,
    CAST(TRIM(no_of_tests) AS INT) AS no_of_tests,
    CAST(TRIM(no_of_tests_submissions) AS INT) AS no_of_tests_submissions,
    CAST(TRIM(no_of_tests_passed) AS INT) AS no_of_tests_passed,
    CAST(TRIM(lms_overall_score) AS FLOAT) AS lms_overall_score,
    TRIM(is_lms_overall_score_higher_than_score_threshold) AS is_lms_overall_score_higher_than_score_threshold,
    TRIM(lms_course_status) AS lms_course_status,
    TRIM(ehub_course_status) AS ehub_course_status,
    TRIM(ehub_class_status) AS ehub_class_status,
    TRIM(is_course_paused) AS is_course_paused,
    TRIM(course_leave_of_absence_reason) AS course_leave_of_absence_reason
FROM bronze.pw_learner_activity;
